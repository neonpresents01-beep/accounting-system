name: Build Windows EXE - Debug
on: [push, workflow_dispatch]
jobs:
  build:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Verify account.py exists
      run: |
        echo "Checking files in root directory:"
        dir
        echo "File content of account.py (first 10 lines):"
        type account.py | head -n 10 || echo "Cannot read file"
    
    - uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install dependencies with verbose
      run: |
        pip install --verbose pyinstaller
        pip install pyqt5 pandas scikit-learn numpy pyjwt
        
    - name: Test Python script
      run: |
        echo "Testing if account.py runs:"
        python account.py || echo "Script had errors but continuing..."
        
    - name: Build with detailed output
      run: |
        echo "Starting PyInstaller build..."
        pyinstaller --onefile --windowed --name "AccountingSystem" --log-level DEBUG account.py
        echo "Build completed. Checking dist folder:"
        dir dist || echo "dist folder not found"
        dir build || echo "build folder not found"
        
    - name: Check build results
      run: |
        echo "=== Build Folder ==="
        dir build /s || echo "No build folder"
        echo "=== Dist Folder ==="
        dir dist /s || echo "No dist folder"
        
    - name: Upload Artifact
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: Build-Debug-Results
        path: |
          dist/
          build/
          *.log
        retention-days: 3
